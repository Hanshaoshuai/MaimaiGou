<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="renderer" content="webkit|ie-comp|ie-stand">
            <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
                <meta http-equiv="Cache-Control" content="no-siteapp" />
                <link href="/public/admin/assets/css/bootstrap.min.css" rel="stylesheet" />
                <link rel="stylesheet" href="/public/admin/css/style.css"/>       
                <link href="/public/admin/assets/css/codemirror.css" rel="stylesheet">
                    <link rel="stylesheet" href="/public/admin/assets/css/ace.min.css" />
                    <link rel="stylesheet" href="font/css/font-awesome.min.css" />
                    <!--[if lte IE 8]>
                              <link rel="stylesheet" href="/public/admin/assets/css/ace-ie.min.css" />
                            <![endif]-->
                    <script src="/public/admin/js/jquery-1.9.1.min.js"></script>
                    <script src="/public/admin/assets/js/bootstrap.min.js"></script>
                    <script type="text/javascript" src="/public/admin/js/H-ui.js"></script>     
                    <script src="/public/admin/assets/js/typeahead-bs2.min.js"></script>           	
                    <script src="/public/admin/assets/js/jquery.dataTables.min.js"></script>
                    <script src="/public/admin/assets/js/jquery.dataTables.bootstrap.js"></script>
                    <script src="/public/admin/assets/layer/layer.js" type="text/javascript" ></script>          
                    <script src="/public/admin/assets/laydate/laydate.js" type="text/javascript"></script>
                    <script src="/public/admin/assets/js/jquery.easy-pie-chart.min.js"></script>
                    <script src="/public/admin/js/lrtk.js" type="text/javascript" ></script>
                    <title>订单管理</title>
                    </head>

                    <body>
                        <div class="margin clearfix" >
                            <div class="Order_form clearfix" id="Order_form_style">
                                <div class="title_name">购物产品所占比例  
                                    <span class="top_show_btn Statistic_btn">显示</span> 
                                    <span class="Statistic_title Statistic_btn"><a title="隐藏" class="top_close_btn">隐藏</a></span>
                                </div>
                                <div class="hide_style clearfix">
                                    <?php foreach($categoryList as $v){?>
                                    <div class="proportion"> <div class="easy-pie-chart percentage" data-percent="20" data-color="#D15B47"><span class="percent">20</span>%</div><span class="name"><?php echo $v['name']?></span></div>									                                    
                                    <?php } ?>
                                </div>
                            </div>

                            <!--订单表格-->
                            <div class="order_list" id="order_list">
                                <div class="h_products_list clearfix" id="products_list">
                                    <div id="scrollsidebar" class="left_Treeview" >
                                        <div class="show_btn" id="rightArrow" style="display: block; width: 25px;"><!--<span></span>--></div>
                                        <div class="widget-box side_content" style="height: 719px; width: 0px;">
                                            <!-- <div class="side_title"><a title="隐藏" class="close_btn"><span></span></a></div>
                                             <div class="side_list"><div class="widget-header header-color-green2"><h4 class="lighter smaller">订单类型分类</h4></div>
                                                 <div class="widget-body">         
                                                     <ul class="b_P_Sort_list">
                                                         <li><i class="orange  fa fa-reorder"></i><a href="#">全部订单(235)</a></li>
                                                         <li><i class="fa fa-sticky-note pink "></i> <a href="#">食品类(235)</a></li>
                                                         <li><i class="fa fa-sticky-note pink "></i> <a href="#">数码配件(2215)</a> </li>
                                                         <li><i class="fa fa-sticky-note pink "></i> <a href="#">手机(3456)</a></li>
                                                         <li><i class="fa fa-sticky-note pink "></i> <a href="#">电脑(4332)</a></li>
                                                         <li><i class="fa fa-sticky-note pink "></i> <a href="#">厨房用品(1332)</a></li>
                                                         <li><i class="fa fa-sticky-note grey "></i> <a href="#">电子产品(4543)</a></li>
                                                         <li><i class="fa fa-sticky-note red  "></i> <a href="#">红钻会员(343)</a></li>
                                                         <li><i class="fa fa-sticky-note blue "></i> <a href="#">家用电器(2343)</a></li>
                                                         <li><i class="fa fa-sticky-note grey "></i> <a href="#">卫浴</a></li>
                                                     </ul>
                                                 </div>
                                             </div>-->
                                        </div>  
                                    </div>
                                    <!--订单列表-->
                                    <div class="table_menu_list order_style" id="table_order_list">
                                        <div class="search_style">
                                            <div class="title_names">搜索查询</div>
                                            <form action="" method="post" id="frm">
                                                <ul class="search_content clearfix">
                                                    <li>
                                                        <select class="text_add" style="" name="order_status">
                                                            <option value="">订单状态</option>
                                                            <option value="0">未付款</option>
                                                            <option value="1">待发货</option>
                                                            <option value="2">待收货</option>
                                                            <option value="3">已收货</option>
                                                            <option value="5">成功</option>
                                                        </select>
                                                        <select class="text_add" style="" name="payment_status">
                                                            <option value="">支付状态</option>
                                                            <option value="0">未支付</option>
                                                            <option value="1">已支付</option>
                                                        </select>  
                                                        <select class="text_add" style="" name="payment_method">
                                                            <option value="">支付方式</option>
                                                            <option value="upacp">银联</option>
                                                            <option value="alipay">支付宝</option>
                                                            <option value="maidou">麦豆</option>
                                                        </select>
                                                        <input class="inline laydate-icon" id="start1" style=" margin-left:10px;" name="beginTime">--<input class="inline laydate-icon" id="begin1" style=" margin-left:10px;" name="endTime">
                                                                <input style="margin-left:0px;" name="order_product_sn" type="text" class="text_add" placeholder="订单号" >
                                                                    <input style="margin-left:0px;" name="phone" type="text" class="text_add" placeholder="手机号码" >
                                                                        <!--input style="margin-left:0px;" name="" type="text" class="text_add" placeholder="收货人" -->
                                                                        </li> 
                                                                        <li><button type="button" class="btn_search" onclick="javascript:document.getElementById('frm').submit();"><i class="fa fa-search"></i>查询</button></li>
                                                                        <li style="clear:both;">&nbsp;</li>
                                                                        <!--li><button type="button"   onclick="javascript:alert('暂未开放');" class="btn_search"><i class="fa fa-search"></i>导出</button></li-->
                                                                        </form>

                                                                        <form action='<?php U("importExcl")?>' enctype="multipart/form-data"  method='post' id="frm1">
                                                                            <li style="margin-top:20px;"><input type='file' name='filename'></li>
                                                                            <li style="margin-top:20px;"><button type="button"   onclick="javascript:document.getElementById('frm1').submit();" class=""><i class="fa fa-search"></i>导入</button></li>
                                                                        </form>
                                                                        <li style="clear:both;">&nbsp;</li>
                                                                        <form action='<?php U("updateOrderAll")?>' enctype="multipart/form-data"  method='post' id="frm2">
                                                                            <li style="margin-top:20px;"><input type='file' name='filename'></li>
                                                                            <li style="margin-top:20px;"><button type="button"   onclick="javascript:document.getElementById('frm2').submit();" class=""><i class="fa fa-search"></i>批量更新订单</button></li>
                                                                        </form>                                             
                                                                        <li style="clear:both;">&nbsp;</li>
                                                                        <form action='<?php U("exportOrder")?>' enctype="multipart/form-data"  method='post' id="frm11">
                                                                            <li style="margin-top:20px;"><label class="l_f"></label><input class="inline laydate-icon" id="start" style=" margin-left:10px;" name="beginTime">--<input class="inline laydate-icon" id="begin" style=" margin-left:10px;" name="endTime"></li>
                                                                                        <li style="margin-top:20px;"><button type="button"   onclick="javascript:document.getElementById('frm11').submit();" class=""><i class="fa fa-search"></i>导出</button></li>
                                                                                        </form>

                                                                                        </ul>

                                                                                        </div>
                                                                                        <!--订单列表展示-->
                                                                                        <table  class="table table-striped table-bordered table-hover" id="sample-table">
                                                                                            <thead>
                                                                                                <tr>
                                                                                                    <th width="25px"><label><input type="checkbox" class="ace"><span class="lbl"></span></label></th>
                                                                                                    <th width="120px">订单编号</th>
                                                                                                    <th width="250px">产品名称</th>
                                                                                                    <th width="100px">价格</th>
                                                                                                    <th width="100px">产品图片</th>
                                                                                                    <th width="100px">下单时间</th>
                                                                                                    <th width="100px">付款时间</th>
                                                                                                    <th width="180px">所属类型</th>
                                                                                                    <th width="80px">数量</th>
                                                                                                    <th width="70px">状态</th>                
                                                                                                    <th width="200px">操作</th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody>  
                                                                                                <?php if(!empty($orderList)){?>
                                                                                                <?php foreach($orderList as $v){ ?>
                                                                                                <tr>
                                                                                                    <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>
                                                                                                    <td><?php echo $v['order_product_sn']?></td>
                                                                                                    <td><?php echo $v['product_name']?></td>
                                                                                                    <td><?php echo $v['price']?></td>                                                                                                    
                                                                                                    <td class="order_product_name">
                                                                                                        <a href="#"></a>
                                                                                                        <i class="fa fa-plus"></i>
                                                                                                        <a href="#"><img src="<?php echo $v['product_img']?>"  onerror="javascript:this.src='/public/admin/products/p_2.jpg'"  title="产品名称"/></a>
                                                                                                    </td>
                                                                                                    <td><?php if($v['ctime']!="") echo date("Y-m-d H:i:s",$v['ctime'])?></td>
                                                                                                    <td><?php if($v['pay_time']!="" && $v['pay_time']!=0) echo date("Y-m-d H:i:s",$v['pay_time'])?></td>
                                                                                                    <td><?php echo $v['name']?></td>
                                                                                                    <td><?php echo $v['product_num']?></td>
                                                                                                    <td >
                                                                                                        <span class="label label-success radius">
                                                                                                            <?php 
                                                                                                            if($v['order_status']==0){
                                                                                                            echo "未付款";
                                                                                                            }elseif($v['order_status']==1){
                                                                                                            echo "待发货";
                                                                                                            }elseif($v['order_status']==2){
                                                                                                            echo "待收货";
                                                                                                            }elseif($v['order_status']==3){
                                                                                                            echo "已收货";
                                                                                                            }elseif($v['order_status']==4){
                                                                                                            echo "待评价";
                                                                                                            }elseif($v['order_status']==5){
                                                                                                            echo "成功";
                                                                                                            }
                                                                                                            ?>                                                                                    
                                                                                                        </span>
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <?php if($v['order_status']==1){?>
                                                                                                        <a onClick="Delivery_stop(this, '<?php echo $v["id"];?>')"  href="javascript:;" title="发货"  class="btn btn-xs btn-success"><i class="fa fa-cubes bigger-120">发货</i></a> 
                                                                                                        <?php }?>
                                                                                                        <?php if(($v["pay_order_num"]!="" || $v["pay_order_num_one"]!="")  && $v["order_status"]!=1){?>
                                                                                                        <?php if($v["pay_order_num"]!="") $pay_order_num=$v["pay_order_num"]; else $pay_order_num=$v["pay_order_num_one"];?>
                                                                                                        <a title="订单详细"  href="javascript:;"   onclick="checkOrder('<?php echo $pay_order_num;?>')" class="" ><i class="fa fa-list bigger-120">更新订单</i></a> 
                                                                                                        <?php }?>
                                                                                                        <a title="订单详细"   href="<?php U('OrderDetailed',array('order_product_sn'=>$v['order_product_sn']));?>"  class="btn btn-xs btn-info order_detailed" ><i class="fa fa-list bigger-120">详情</i></a> 
                                                                                                        <a title="删除" href="javascript:;"  onclick="Order_form_del(this, '<?php echo $v["id"];?>')" class="btn btn-xs btn-warning" ><i class="fa fa-trash  bigger-120">删除</i></a>    
                                                                                                    </td>
                                                                                                </tr>  
                                                                                                <?php }} ?>
                                                                                            </tbody>
                                                                                        </table>
                                                                                        <script>
                                                                                            function checkOrder(id){
                                                                                            var url = "<?php U('checkPaymentOrder');?>";
                                                                                            $.ajax({
                                                                                            type:'post',
                                                                                                    data:'t=' + new Date() + '&id=' + id,
                                                                                                    url:url,
                                                                                                    success:function(msg){
                                                                                                    alert(msg);
                                                                                                    }
                                                                                            })
                                                                                            }
                                                                                        </script>
                                                                                        </div>
                                                                                        </div>
                                                                                        </div>
                                                                                        <!--发货-->
                                                                                        <div id="Delivery_stop" style=" display:none">
                                                                                            <div class="">
                                                                                                <div class="content_style">
                                                                                                    <div class="form-group"><label class="col-sm-2 control-label no-padding-right" for="form-field-1">快递公司 </label>
                                                                                                        <div class="col-sm-9"><select class="form-control" id="form-field-select-1">
                                                                                                                <option value="">--选择快递--</option>
                                                                                                               <?php foreach($kuaidi as $kuaidiV){?>
                                                                                                                <option value="<?php echo $kuaidiV['com'];?>"><?php echo $kuaidiV['name'];?></option>                                                                                           
                                                                                                                <?php }?>
                                                                                                            </select></div>
                                                                                                    </div>
                                                                                                    <div class="form-group"><label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 快递号 </label>
                                                                                                        <div class="col-sm-9"><input type="text" id="form-field-1" placeholder="快递号" class="col-xs-10 col-sm-5" style="margin-left:0px;"></div>
                                                                                                    </div>
                                                                                                    <div class="form-group"><label class="col-sm-2 control-label no-padding-right" for="form-field-1">货到付款 </label>
                                                                                                        <div class="col-sm-9"><label><input name="checkbox" type="checkbox" class="ace" id="checkbox"><span class="lbl"></span></label></div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        </body>
                                                                                        </html>
                                                                                        <script>
                                                                                            //左侧显示隐藏
                                                                                            /* $(function () {
                                                                                             $("#order_list").fix({
                                                                                             float: 'left',
                                                                                             //minStatue : true,
                                                                                             skin: 'green',
                                                                                             durationTime: false,
                                                                                             spacingw: 50, //设置隐藏时的距离
                                                                                             spacingh: 270, //设置显示时间距
                                                                                             close_btn: '.close_btn',
                                                                                             show_btn: '.show_btn',
                                                                                             side_list: '.side_list',
                                                                                             });
                                                                                             });*/
                                                                                            //顶部隐藏显示
                                                                                            $(function () {
                                                                                            $("#Order_form_style").fix({
                                                                                            float: 'top',
                                                                                                    //minStatue : true,
                                                                                                    skin: 'green',
                                                                                                    durationTime: true,
                                                                                                    spacingw: 0,
                                                                                                    spacingh: 0,
                                                                                                    close_btn: '.top_close_btn',
                                                                                                    show_btn: '.top_show_btn',
                                                                                                    side_list: '.hide_style',
                                                                                                    close_btn_width: 80,
                                                                                                    side_title: '.Statistic_title',
                                                                                            });
                                                                                            });
                                                                                            //时间选择
                                                                                            laydate({
                                                                                            elem: '#start',
                                                                                                    event: 'focus'
                                                                                            });
                                                                                            laydate({
                                                                                            elem: '#begin',
                                                                                                    event: 'focus'
                                                                                            });
                                                                                            laydate({
                                                                                            elem: '#start1',
                                                                                                    event: 'focus'
                                                                                            });
                                                                                            laydate({
                                                                                            elem: '#begin1',
                                                                                                    event: 'focus'
                                                                                            });
                                                                                            /*订单-删除*/
                                                                                            function Order_form_del(obj, id) {
                                                                                            layer.confirm('确认要删除吗？', function (index) {
                                                                                            var url = "<?php U('orderDel');?>";
                                                                                            $.ajax({
                                                                                            url: url,
                                                                                                    data: 'time=' + new Date() + '&id=' + id,
                                                                                                    type: 'post',
                                                                                                    success: function (msg) {
                                                                                                    var msg = eval('(' + msg + ')');
                                                                                                    if (msg.code == "1000") {
                                                                                                    $(obj).parents("tr").remove();
                                                                                                    layer.msg('已删除!', {icon: 1, time: 1000});
                                                                                                    } else {
                                                                                                    layer.msg('删除失败!', {icon: 1, time: 1000});
                                                                                                    }
                                                                                                    }
                                                                                            })

                                                                                            });
                                                                                            }
                                                                                            /**发货**/
                                                                                            function Delivery_stop(obj, id) {
                                                                                            layer.open({
                                                                                            type: 1,
                                                                                                    title: '发货',
                                                                                                    maxmin: true,
                                                                                                    shadeClose: false,
                                                                                                    area: ['500px', ''],
                                                                                                    content: $('#Delivery_stop'),
                                                                                                    btn: ['确定', '取消'],
                                                                                                    yes: function (index, layero) {
                                                                                                    if ($('#form-field-1').val() == "") {
                                                                                                    layer.alert('快递号不能为空！', {
                                                                                                    title: '提示框',
                                                                                                            icon: 0,
                                                                                                    })

                                                                                                    } else {
                                                                                                    var url = "<?php U('logisticsInsert');?>";
                                                                                                    $.ajax({
                                                                                                    url: url,
                                                                                                            data: 'time=' + new Date() + '&id=' + id + '&logistics_order=' + $('#form-field-1').val() + "&logistics_com=" + $("#form-field-select-1 option:selected").val(),
                                                                                                            type: 'post',
                                                                                                            success: function (msg) {
                                                                                                            var msg = eval('(' + msg + ')');
                                                                                                            if (msg.code == "1000") {
                                                                                                            layer.confirm('提交成功！', function (index) {
                                                                                                            layer.msg('提交成功', {icon: 6, time: 1000});
                                                                                                            });
                                                                                                            layer.close(index);
                                                                                                            } else {
                                                                                                            layer.confirm('提交失败！', function (index) {
                                                                                                            layer.msg('提交失败', {icon: 6, time: 1000});
                                                                                                            });
                                                                                                            layer.close(index);
                                                                                                            }

                                                                                                            }
                                                                                                    });
                                                                                                    }

                                                                                                    }
                                                                                            })
                                                                                            }
                                                                                            ;
                                                                                            //面包屑返回值
                                                                                            var index = parent.layer.getFrameIndex(window.name);
                                                                                            parent.layer.iframeAuto(index);
                                                                                            $('.Order_form,.order_detailed').on('click', function () {
                                                                                            var cname = $(this).attr("title");
                                                                                            var chref = $(this).attr("href");
                                                                                            var cnames = parent.$('.Current_page').html();
                                                                                            var herf = parent.$("#iframe").attr("src");
                                                                                            parent.$('#parentIframe').html(cname);
                                                                                            parent.$('#iframe').attr("src", chref).ready();
                                                                                            ;
                                                                                            parent.$('#parentIframe').css("display", "inline-block");
                                                                                            parent.$('.Current_page').attr({"name": herf, "href": "javascript:void(0)"}).css({"color": "#4c8fbd", "cursor": "pointer"});
                                                                                            //parent.$('.Current_page').html("<a href='javascript:void(0)' name="+herf+" class='iframeurl'>" + cnames + "</a>");
                                                                                            parent.layer.close(index);
                                                                                            });
                                                                                            //初始化宽度、高度
                                                                                            $(".hide_style").height($(".hide_style").height());
                                                                                            var heights = $(".hide_style").outerHeight(true) + 90;
                                                                                            $(".widget-box").height($(window).height() - heights);
                                                                                            $(".table_menu_list").width($(window).width() - 250);
                                                                                            $(".table_menu_list").height($(window).height() - heights);
                                                                                            //当文档窗口发生改变时 触发  
                                                                                            $(window).resize(function () {
                                                                                            $(".widget-box").height($(window).height() - heights);
                                                                                            $(".table_menu_list").width($(window).width() - 250);
                                                                                            $(".table_menu_list").height($(window).height() - heights);
                                                                                            })
                                                                                                    //比例
                                                                                                    var oldie = /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());
                                                                                            $('.easy-pie-chart.percentage').each(function () {
                                                                                            $(this).easyPieChart({
                                                                                            barColor: $(this).data('color'),
                                                                                                    trackColor: '#EEEEEE',
                                                                                                    scaleColor: false,
                                                                                                    lineCap: 'butt',
                                                                                                    lineWidth: 10,
                                                                                                    animate: oldie ? false : 1000,
                                                                                                    size: 103
                                                                                            }).css('color', $(this).data('color'));
                                                                                            });
                                                                                            $('[data-rel=tooltip]').tooltip();
                                                                                            $('[data-rel=popover]').popover({html: true});
                                                                                        </script>
                                                                                        <script>
                                                                                            //订单列表
                                                                                            jQuery(function ($) {
                                                                                            var oTable1 = $('#sample-table').dataTable({
                                                                                            "aaSorting": [[1, "desc"]], //默认第几个排序
                                                                                                    "bStateSave": true, //状态保存
                                                                                                    "aoColumnDefs": [
                                                                                                            //{"bVisible": false, "aTargets": [ 3 ]} //控制列的隐藏显示
                                                                                                            {"orderable": false, "aTargets": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]}// 制定列不参与排序
                                                                                                    ]});
                                                                                            $('table th input:checkbox').on('click', function () {
                                                                                            var that = this;
                                                                                            $(this).closest('table').find('tr > td:first-child input:checkbox')
                                                                                                    .each(function () {
                                                                                                    this.checked = that.checked;
                                                                                                    $(this).closest('tr').toggleClass('selected');
                                                                                                    });
                                                                                            });
                                                                                            $('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
                                                                                            function tooltip_placement(context, source) {
                                                                                            var $source = $(source);
                                                                                            var $parent = $source.closest('table')
                                                                                                    var off1 = $parent.offset();
                                                                                            var w1 = $parent.width();
                                                                                            var off2 = $source.offset();
                                                                                            var w2 = $source.width();
                                                                                            if (parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2))
                                                                                                    return 'right';
                                                                                            return 'left';
                                                                                            }
                                                                                            });
                                                                                            // document.getElementById("sample-table").style.width="1145px";
                                                                                        </script>
